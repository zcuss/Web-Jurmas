<!-- Font Awesome & Bootstrap -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="/css/sidebar.css">

<div class="d-flex">
  <!-- Sidebar -->
  <div id="sidebar" class="sidebar bg-dark text-white position-fixed">
    <div class="sidebar-title d-flex align-items-center px-3 py-3 border-bottom border-secondary">
      <i class="fas fa-clipboard-list me-2"></i>
      <span class="fs-5 fw-semibold">JURU MASAK</span>
    </div>

    <%
      // ========================
      // Role Hierarchy
      // ========================
      const roleHierarchy = {
        user: ["user"],
        mod: ["user", "mod"],
        admin: ["user", "mod", "admin"],
        superadmin: ["user", "mod", "admin", "superadmin"] // <- tambah "mod"
      };


      const userRoles = roleHierarchy[user?.role] || [];

      // ========================
      // Helper Function
      // ========================
      function canAccess(item) {
        if (process.env.DEBUG_MODE === "true") return true; // bypass untuk debug
        if (!item.roles) return true; // default: semua user boleh
        return item.roles.some(r => userRoles.includes(r));
      }

      // ========================
      // Menu Definition
      // (tulis role minimum aja)
      // ========================
      const menu = [
        { href: "/dashboard", route: "dashboard", icon: "fa-file-alt", label: "Dashboard" },
        { href: "/kalkulator", route: "kalkulator", icon: "fa-tags", label: "Kalkulator", roles: ["superadmin"] },
        { href: "/Withdraw/WithdrawForm", route: "WithdrawForm", icon: "fa-newspaper", label: "WD Form" },

        { type: "divider", roles: ["superadmin"] },
        { href: "/changelog", route: "changelog", icon: "fa-history", label: "Change Log", roles: ["superadmin"] },
        { href: "/role", route: "role", icon: "fa-hammer", label: "Role", roles: ["superadmin"] },
        
        { type: "divider", roles: ["admin"] },
        { type: "category", icon: "fa-box", label: "Barang", roles: ["admin"] },
        { href: "/harga-bahan", route: "harga-bahan", icon: "fa-tags", label: "Harga Bahan", roles: ["admin"] },
        { href: "/stock-bahan", route: "stock-bahan", icon: "fa-home", label: "Stock Bahan", roles: ["mod"] },
        { href: "/stock-kulkas", route: "stock-kulkas", icon: "fa-snowflake", label: "Stok Kulkas", roles: ["mod"] },
        { href: "/stock-fix", route: "stock-fix", icon: "fa-warehouse", label: "Stock Fix", roles: ["superadmin"] },
        { href: "/restock", route: "restock", icon: "fa-rotate-right", label: "Restock", roles: ["admin"] },
        { href: "/withdraw", route: "withdraw", icon: "fa-box-open", label: "WD (Admin)", roles: ["admin"] },

        { type: "divider", roles: ["mod"] },
        { type: "category", icon: "fa-money-bill-wave", label: "Uang", roles: ["mod"] },
        { href: "/uang-wd", route: "uang-wd", icon: "fa-money-bill-wave", label: "Uang WD", roles: ["mod"] },
        { href: "/uang-kas", route: "uang-kas", icon: "fa-coins", label: "Uang Kas", roles: ["mod"] },
        { href: "/uang-gaji", route: "uang-gaji", icon: "fa-user-tie", label: "Uang Gaji", roles: ["mod"] },

        { type: "divider", roles: ["user"] },
        { type: "category", icon: "fa-clock", label: "Logs", roles: ["user"] },
        { href: "/logs-restock", route: "logs-restock", icon: "fa-file-alt", label: "Logs Restock", roles: ["mod"] },
        { href: "/logs-bahan", route: "logs-bahan", icon: "fa-file-alt", label: "Logs Bahan", roles: ["mod"]  }, // user boleh
        { href: "/logs-wd", route: "logs-wd", icon: "fa-file-alt", label: "Logs WD +", roles: ["mod"] },         // user boleh
        { href: "/logs-wd/user", route: "LogsWdUser", icon: "fa-file-alt", label: "Logs WD", roles: ["user"] },         // user boleh
        { type: "divider" },

        { href: "/setoran_tani", route: "setoran-tani", icon: "fa-tractor", label: "Setoran Tani" },
        { type: "divider" },
        { href: "/logout", route: "logout", icon: "fa-sign-out-alt", label: "Logout" }
      ];
    %>

    <!-- ========================
         Sidebar Render
         ======================== -->
    <ul class="nav flex-column mt-3 px-2">
      <% menu.forEach(item => { 
          if (!canAccess(item)) return;
      %>
        <% if (item.type === "divider") { %>
          <hr class="my-2 border-secondary">
        <% } else if (item.type === "category") { %>
          <li class="category-title">
            <i class="fas <%= item.icon %> me-2"></i><%= item.label %>
          </li>
        <% } else { %>
          <li class="nav-item">
            <a href="<%= item.href %>" 
              class="nav-link px-3 py-2 rounded <%= currentRoute === item.route ? 'active fw-bold' : '' %>"
              <%= currentRoute === item.route ? 'aria-current="page"' : '' %>>
              <i class="fas <%= item.icon %> me-2"></i><%= item.label %>
            </a>
          </li>
        <% } %>
      <% }) %>
    </ul>
  </div>

  <!-- Main Content -->
  <div class="main-content ms-auto p-4" style="margin-left: 250px;">
    <!-- Konten halaman di sini -->
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"></script>
